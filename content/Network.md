### 计算机网络

- TCP/IP四层模型 OSI七层模型  

TCP/IP:应用层、传输层、网络层、网络接口层(链路层、物理层)  
OSI:应用层、表示层、会话层、传输层、网络层、链路层、物理层  

- 详述浏览器访问一个域名(www.baidu.com)网址的全过程  

流程:解析域名->建立TCP连接->发起HTTP请求->服务端响应HTTP请求,浏览器获取到HTML代码->
解析HTML,请求各类静态资源->浏览器进行页面渲染.  

详解:  
解析域名,浏览器首先会查询自身的DNS缓存(缓存时间大概1分钟),如果存在且没有过期则域名解析结束,否则将查询OS缓存,同上存在则域名解析结束,不存在则发起DNS查询报文,
(报文采用UDP协议,端口53),该报文一般会发送给本地DNS服务器(同样具备DNS缓存),本地DNS服务器将该报文转发给根DNS服务器,根DNS服务器不会映射域名IP地址,但他会根据com域向本地
DNS服务器返回负责com域的TLD DNS服务器的IP地址列表,本地DNS服务器根据IP发送查询报文.接收请求的TLD DNS服务器会根据 baidu.com域响应权威DNS服务器的IP地址(一般是由我们注册域名的供应商提供),
该权威DNS服务器负责www.baidu.com与其IP地址的映射,本地DNS向其发送查询报文,权威DNS服务器根据域名响应IP地址.本地DNS服务器得到IP地址后将其发送给我们的OS内核,内核又将其发送给浏览器,至此,浏览器拿到了百度域名的IP地址,这时就可以发起TCP连接了;  

建立TCP连接:域名解析得到目的IP地址,主机开始生成TCP套接字,但在此之前需要先与服务器建立三次握手连接.主机首先生成一个具有目的端口(HTTP 80)的TCP SYN=1 (假设seq=x,实际上是随机的)报文段(层层封装,在网络层
加入目的IP封装为IP数据报,在链路层加入目的MAC地址被封装成帧,并向交换机发送该帧),服务端收到TCP SYN报文,并将之分解到端口80相关联的欢迎套接字,并生成一个连接套接字,产生一个
TCP SYN=1 ACK=1(seq=y,ack=x+1)报文段(同样层层封装),主机收到该报文段,发送最终的TCP SYN=0 ACK=1(seq=x+1.ack=y+1)报文段,此时连接正式建立,双方就可以相互发送包含数据的报文段(实际上第三阶段就可以负载数据了).

发起HTTP请求:浏览器发起GET请求获取首页,服务端出去请求,一般有三种方式->①由一个线程来处理所有请求,后续请求阻塞等等(实际上不会使用);②一个请求对应一个线程(内存与CPU的重负);③IO复用([Nginx由master&多个worker进程](http://tengine.taobao.org/book/chapter_02.html)),例如epoll,通过协程方式,由一个线程统一接收请求,派发给其他线程负责具体请求处理;    

服务端响应HTTP请求,浏览器获取到HTML代码:如果是请求静态页面,一般交由web服务器,例如nginx进行响应(或者其他静态资源缓存服务器),如果是动态的请求,则需要交由应用服务器(例如tomcat),根据请求URL以及请求方法转发到相应的控制器进行处理后返回响应;    

解析HTML,请求各类静态资源:浏览器拿到首页后开始解析html代码,遇到js/css/image等静态资源(一般浏览器会对这些资源进行缓存,根据服务端的响应头对于的键值对来得知过期时间)时,就向服务端去请求下载;    

浏览器进行页面渲染:最终浏览器将请求到的静态资源和HTML代码进行渲染(不同浏览器的渲染效果有差异)呈现给用户.    

- TCP & UDP  

TCP:面向连接的可靠传输协议,提供全双工服务,应用进程相互发送数据的前提是建立三次握手连接(而断开则需四次挥手).采用超时重传、滑动窗口和拥塞控制来保证可靠数据传输.因此常用于需要稳定可靠数据传输的服务,例如
电子邮件(SMTP)、终端访问(Telnet)、web服务(HTTP)、文件传输(FTP)等;  
  
UDP:面向非连接的传输协议,优点是对于数据的应用层控制更为精细(不受拥塞控制协议制约)、无需建立连接没有连接状态、开销小.但数据传输可能丢包,且不保证顺序.常用于IM通讯(网络视频电话之类)、域名解析(DNS)等.  

- 三次握手 & 四次挥手  
![TCP](https://raw.githubusercontent.com/MelloChan/java-interview/master/image/TCP-Connection%26Close.png)

三次握手:客户端想发送数据给服务端,前提是先建立双方的一条TCP连接.第一步客户端将TCP报文段首部SYN标志位置为1,随机选择一个初始序号seq=x,然后发送给服务端;第二步
服务端接收到该报文后也发送一个TCP报文段,服务端将SYN标志位置为1,随机选择一个初始序号seq=y,确认号ack=x+1;第三步收到服务端报文段后,客户端向服务端发送另外一个TCP报文段,
此时首部SYN标志位置为0,seq=x+1,ack=y+1,进行最终连接的确认.  
**三次确保双方连接是全双工的(前两次确认保证服务端能接收客户端消息并能做出正确的应答,后两次保证客户端能接收服务端消息并能做出正确的应答),任何丢失都有超时重传来保证.**  

四次挥手:当客户端(或服务端)想关闭连接时,首先会发送一个TCP报文段,其中首部标志位FIN置为1,当服务端接收到该报文段后,就向客户端回送一个确认报文段(ACK=1).然后服务端发送自己的关闭报文段,
其FIN置为1,最后客户端回送一个确认报文段(ACK=1).此时双方连接关闭,释放连接资源.  
**四次挥手保证了被动关闭的一方能将最终的消息发送出去,例如客户端想关闭连接,但服务端此时可能还有数据发送,因此服务端先发送一个ACK报文回复客户端的关闭请求,
当服务端数据发送完毕后,此时在发送一个FIN报文,而客户端接收到服务端FIN报文后,才正式确认双方都没有数据发送,连接才最终关闭.**

详细信息参阅计算机网络-自顶向下方法 P169.

- 状态码  

1xx:代表请求已被接受,但需要继续处理.例子:WebSocket(实现全双工网络通信协议 基于TCP)中会触发101状态码,因为他是先通过HTTP协议,之后再转为WebSocket协议;    
2xx:代表请求已成功,常见的为200,请求成功;    
3xx:需要浏览器采取进一步的操作才能完成请求,一般是重定向,常见的301(永久重定向)、302(临时重定向)、304;  
4xx:浏览器请求错误,常见的404(请求的资源在服务器上并不存在,403(服务器理解了请求,但拒绝执行);  
5xx:服务器出错.   

- 301 & 302

301:永久重定向,访问的url已永久转移到另一个url.这种改变是永久的.换句话说旧的url已被抛弃而转为新的url.  

302:临时重定向,新旧网址都将被保存,这意味着仅仅是临时性的将资源进行转移,新旧地址资源都能访问.(servlet的重定向).  

注:302容易发生网址劫持.  

- HTTP HTTPS

应用层协议,HTTP默认端口80,传输信息都是明文的,通过fiddler等抓包软件就可分析其内容,因此不会用来传输私密内容(还有诸如HTTP劫持之类的,实际上现在全站HTTPS是趋势),这时HTTPS就派上用场了(安全建立在SSL/TLS),默认端口则是443,传输信息都经过加密(对称加密算法),而密钥则经过非对称加密,客户端服务端都可对身份进行验证.  
详细参阅:https://www.zhihu.com/question/19577317

- GET & POST  

归属HTTP的请求方法,GET使用广泛,用来获取静态资源页面之类,而POST更多用于表单提交,有时会说POST相比GET请求更为安全,那是因为GET发送参数请求会将参数附加在浏览器地址栏(另外也有长度限制)而POST是放在请求体,但实质上通过抓包(fiddler之类)不管是哪种请求的参数都能获取,真正安全还需要加密以及HTTPS.
另外在规范上GET是幂等的且可缓存的,在请求体上没有任何数据,POST则是不幂等不可缓存的.  
详情可参阅:https://www.zhihu.com/question/28586791

- Session & Cookie  

因为HTTP是无状态的,也就是说每一次请求对于服务端来说都是全新的,但我们总是需要了解请求发送的对象是谁.而Cookie(Session机制)就是用来保存用户个人信息的.  

Session是保存在服务端中的,一般放在内存中(当然DB或硬盘文件也可以),不会保存过大的对象信息,因为并发量过高时会对内存造成压力.在JavaWeb中,Session保存完毕响应请求时,会将对应的sessionId回写在响应体的 set-cookie 中作为用户信息凭证,当客户端再次发送请求时就设置在Cookie中(所以说实质上Session是建立在Cookie上的,只是换了种形式表达,不明文存储用户信息因此相对安全),另外Session的是基于当前浏览器的,默认过期时间半小时.当浏览器禁止Cookie时可通过url重写来设置sessionId.  

Cookie是保存在客户端的,明文存储用户的个人信息,容易被窃取造成用户个人信息泄露.另外浏览器(不同浏览器限制不同)对Cookie有存储限制(个数与大小).  

扩展话题:Session服务器集群、memcached或redis缓存服务......

- Socket  

即套接字,ip + port的组合,是一组接口,应用程序间通过套接字进行网络通讯(数据交互).可使用传输层TCP或UDP作为通信协议.一般两个应用程序间为Server/Client的关系. 